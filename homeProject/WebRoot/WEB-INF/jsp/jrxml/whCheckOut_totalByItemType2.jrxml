<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report1" language="groovy" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="579" leftMargin="8" rightMargin="8" topMargin="8" bottomMargin="8" uuid="208592e9-26af-40c2-83e9-6a714f473336">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="LogoFile" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["D:/logo.jpg"]]></defaultValueExpression>
	</parameter>
	<parameter name="No" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select  ItemType2Descr, round(sum(ProjectCost), 2) SumProjectCost,
        round(sum(SumCost2), 2) SumCost2
from    ( select    e.descr Itemtype2descr,
                    sum(b.SendQty * c.projectCost) projectCost,
                    sum(b.SendQty * b.Cost) SumCost2
          from      tItemAppSend a
                    left outer join tItemAppSendDetail b on a.No = b.No
                    left outer join tItemAppDetail c on b.RefPK = c.PK
                    left outer join tItem d on c.ItemCode = d.Code
                    left outer join tItemType2 e on d.ItemType2 = e.Code
          where a.WHCheckOutNo=$P{No}
          group by  e.Descr
          union all
          select    e.descr Itemtype2descr, 0 projectCost,
                    sum(case when type = 'R' then t1.Qty * t1.BCost * -1
                             else t1.Qty * t1.BCost
                        end) SumCost2
          from      tSalesInvoice c
                    left outer join tSalesInvoiceDetail t1 on t1.sino = c.no
                    left outer join titem f on f.code = t1.itcode
                    left outer join tItemtype2 e on e.code = f.itemtype2
           where c.WHCheckOutNo=$P{No}
          group by  e.descr, projectCost
        ) k
group by k.Itemtype2descr]]>
	</queryString>
	<field name="ItemType2Descr" class="java.lang.String"/>
	<field name="SumCost2" class="java.lang.Number"/>
	<field name="SumProjectCost" class="java.lang.Number"/>
	<variable name="COLUMN_INDEX" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$V{COLUMN_INDEX}.valueOf(1)]]></variableExpression>
		<initialValueExpression><![CDATA[1]]></initialValueExpression>
	</variable>
	<variable name="TotalSumCost2" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{SumCost2}]]></variableExpression>
	</variable>
	<variable name="TotalSumProjectCost" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{SumProjectCost}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="21" splitType="Stretch"/>
	</title>
	<pageHeader>
		<band splitType="Stretch">
			<printWhenExpression><![CDATA[$V{PAGE_NUMBER}>1]]></printWhenExpression>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="118" y="0" width="28" height="20" uuid="7e6a65b6-c610-45a1-b60d-b702d623c06b"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<text><![CDATA[序号]]></text>
			</staticText>
			<staticText>
				<reportElement x="146" y="0" width="80" height="20" uuid="1423e622-ef6c-43fb-bc25-ebef3be775ed"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<text><![CDATA[材料类型2]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" x="226" y="0" width="129" height="20" uuid="80dda8f7-b72c-4ac8-9c87-97037b9a92f5"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<text><![CDATA[总金额]]></text>
			</staticText>
			<staticText>
				<reportElement x="355" y="0" width="100" height="20" uuid="3aa11e2d-c941-4689-80b6-aee9b6bf0485"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<text><![CDATA[项目经理结算价]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="118" y="0" width="28" height="20" uuid="1f7e5098-e2fc-4f66-a9b5-8dbe11a55dfa"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{COLUMN_INDEX}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="146" y="0" width="80" height="20" uuid="d5375c14-c654-4f16-a5f5-c7cec9ca0d0f"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ItemType2Descr}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="226" y="0" width="129" height="20" isPrintInFirstWholeBand="true" uuid="eebbecd9-42b5-4795-b0b7-5ee36f46fc4c"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{SumCost2}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="355" y="0" width="100" height="20" uuid="e10d9ced-0fc1-4990-adeb-2fe38ecde835"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{SumProjectCost}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<summary>
		<band height="82" splitType="Stretch">
			<textField isStretchWithOverflow="true" pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="226" y="0" width="129" height="20" isPrintInFirstWholeBand="true" uuid="cb17e34c-5913-4338-847c-7c1fe8dd01dc"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TotalSumCost2}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="355" y="0" width="100" height="20" uuid="1824744c-553d-4c57-a745-f04786e9bc15"/>
				<box>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TotalSumProjectCost}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="118" y="0" width="108" height="20" uuid="4aa2749d-1537-4339-8948-5570d83d45a4"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="宋体" size="12" isBold="true" pdfFontName="STSong-Light" pdfEncoding="UniGB-UCS2-H" isPdfEmbedded="true"/>
				</textElement>
				<text><![CDATA[合计]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
